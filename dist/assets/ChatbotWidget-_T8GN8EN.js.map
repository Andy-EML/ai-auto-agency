{"version":3,"file":"ChatbotWidget-_T8GN8EN.js","sources":["../../src/components/ChatbotWidget.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { X, Send } from 'lucide-react';\nimport { ChatMessage } from '../types';\nimport { CONSTANTS } from '../constants';\n\nconst CHATBOT_WEBHOOK_URL = import.meta.env.VITE_CHATBOT_WEBHOOK_URL || '';\n\nexport function ChatbotWidget() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [sessionId] = useState(() => `${CONSTANTS.SESSION_ID_PREFIX}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\n  const [hasAutoOpened, setHasAutoOpened] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    const hasVisited = localStorage.getItem(CONSTANTS.CHATBOT_VISITED_KEY);\n    if (!hasVisited && !hasAutoOpened) {\n      const timer = setTimeout(() => {\n        setIsOpen(true);\n        setHasAutoOpened(true);\n        localStorage.setItem(CONSTANTS.CHATBOT_VISITED_KEY, 'true');\n\n        const welcomeMessage: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: CONSTANTS.CHATBOT_WELCOME_MESSAGE,\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: CONSTANTS.WEBHOOK_SOURCE_CHATBOT,\n          isBot: true,\n        };\n        setMessages([welcomeMessage]);\n      }, CONSTANTS.CHATBOT_AUTO_OPEN_DELAY_MS);\n\n      return () => clearTimeout(timer);\n    }\n  }, [hasAutoOpened, sessionId]);\n\n  // Listen for custom event to open chatbot\n  useEffect(() => {\n    const handleOpenChatbot = () => {\n      setIsOpen(true);\n      if (messages.length === 0) {\n        const welcomeMessage: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: CONSTANTS.CHATBOT_WELCOME_MESSAGE,\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: CONSTANTS.WEBHOOK_SOURCE_CHATBOT,\n          isBot: true,\n        };\n        setMessages([welcomeMessage]);\n      }\n    };\n\n    window.addEventListener('openChatbot', handleOpenChatbot);\n    return () => window.removeEventListener('openChatbot', handleOpenChatbot);\n  }, [sessionId, messages.length]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  useEffect(() => {\n    if (isOpen && !isLoading) {\n      inputRef.current?.focus();\n    }\n  }, [isOpen, isLoading]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!inputMessage.trim() || isLoading) return;\n\n    const userMessage: ChatMessage = {\n      id: `msg_${Date.now()}`,\n      sessionId,\n      message: inputMessage,\n      timestamp: new Date().toISOString(),\n      pageUrl: window.location.href,\n      source: 'website_chatbot',\n      isBot: false,\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    try {\n      if (CHATBOT_WEBHOOK_URL) {\n        console.log('Sending to webhook:', CHATBOT_WEBHOOK_URL);\n        console.log('Payload:', {\n          sessionId: userMessage.sessionId,\n          message: userMessage.message,\n          timestamp: userMessage.timestamp,\n          pageUrl: userMessage.pageUrl,\n          source: userMessage.source,\n        });\n\n        const response = await fetch(CHATBOT_WEBHOOK_URL, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            sessionId: userMessage.sessionId,\n            message: userMessage.message,\n            timestamp: userMessage.timestamp,\n            pageUrl: userMessage.pageUrl,\n            source: userMessage.source,\n          }),\n        });\n\n        console.log('Response status:', response.status);\n        console.log('Response ok:', response.ok);\n\n        if (response.ok) {\n          const responseText = await response.text();\n          console.log('Raw response text:', responseText);\n\n          let data;\n          try {\n            data = JSON.parse(responseText);\n            console.log('Parsed response data:', data);\n\n            // Handle array response format from n8n\n            if (Array.isArray(data) && data.length > 0) {\n              data = data[0];\n              console.log('Extracted first item from array:', data);\n            }\n          } catch (parseError) {\n            console.error('JSON parse error:', parseError);\n            console.log('Response was not valid JSON, using as plain text');\n            data = { output: responseText };\n          }\n\n          const botReply: ChatMessage = {\n            id: `msg_${Date.now()}`,\n            sessionId,\n            message: data.output || data.reply || \"Thanks for your message! We'll get back to you shortly.\",\n            timestamp: new Date().toISOString(),\n            pageUrl: window.location.href,\n            source: 'website_chatbot',\n            isBot: true,\n          };\n          setMessages((prev) => [...prev, botReply]);\n        } else {\n          console.error('Webhook failed with status:', response.status);\n          throw new Error('Webhook failed');\n        }\n      } else {\n        console.log('No webhook URL configured');\n        const botReply: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Thanks for reaching out! Our team will respond soon. You can also email us at hello@antekautomation.com\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages((prev) => [...prev, botReply]);\n      }\n    } catch (error) {\n      console.error('Chatbot error:', error);\n      const errorMessage: ChatMessage = {\n        id: `msg_${Date.now()}`,\n        sessionId,\n        message: \"Connection error. Please try again or email us at hello@antekautomation.com\",\n        timestamp: new Date().toISOString(),\n        pageUrl: window.location.href,\n        source: 'website_chatbot',\n        isBot: true,\n      };\n      setMessages((prev) => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <>\n      {isOpen && (\n        <div className=\"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50\">\n          <div className=\"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-black text-xl uppercase\">Antek AI</h3>\n              <p className=\"text-xs text-charcoal\">Always here to help</p>\n            </div>\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"text-charcoal hover:text-terracotta transition-colors p-2\"\n              aria-label=\"Close chat\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white\">\n            {messages.map((msg) => (\n              <div\n                key={msg.id}\n                className={`flex ${msg.isBot ? 'justify-start' : 'justify-end'}`}\n              >\n                <div\n                  className={`max-w-[70%] ${\n                    msg.isBot\n                      ? 'bg-white border-2 border-charcoal shadow-brutal-msg'\n                      : 'bg-warm-beige border-2 border-charcoal shadow-brutal-msg'\n                  } p-3 rounded-sm`}\n                >\n                  <p className=\"text-charcoal text-sm leading-normal\">{msg.message}</p>\n                </div>\n              </div>\n            ))}\n            {isLoading && (\n              <div className=\"flex justify-start\">\n                <div className=\"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm\">\n                  <div className=\"flex space-x-2\">\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white\">\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={inputMessage}\n              onChange={(e) => setInputMessage(e.target.value)}\n              placeholder=\"Type message...\"\n              className=\"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal\"\n              disabled={isLoading}\n            />\n            <button\n              type=\"submit\"\n              disabled={isLoading || !inputMessage.trim()}\n              className=\"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <Send className=\"w-5 h-5\" />\n            </button>\n          </form>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["CHATBOT_WEBHOOK_URL","ChatbotWidget","isOpen","setIsOpen","useState","messages","setMessages","inputMessage","setInputMessage","isLoading","setIsLoading","sessionId","CONSTANTS","SESSION_ID_PREFIX","Date","now","Math","random","toString","substr","hasAutoOpened","setHasAutoOpened","messagesEndRef","useRef","inputRef","useEffect","localStorage","getItem","CHATBOT_VISITED_KEY","timer","setTimeout","setItem","welcomeMessage","id","message","CHATBOT_WELCOME_MESSAGE","timestamp","toISOString","pageUrl","window","location","href","source","WEBHOOK_SOURCE_CHATBOT","isBot","CHATBOT_AUTO_OPEN_DELAY_MS","clearTimeout","handleOpenChatbot","length","addEventListener","removeEventListener","_a","current","scrollIntoView","behavior","focus","Fragment","children","className","jsxs","jsxRuntimeExports","jsx","onClick","X","map","msg","style","animationDelay","ref","onSubmit","async","e","preventDefault","trim","userMessage","prev","console","log","response","fetch","method","headers","body","JSON","stringify","status","ok","error","Error","responseText","text","data","parse","Array","isArray","parseError","output","botReply","reply","errorMessage","type","value","onChange","target","placeholder","disabled","Send"],"mappings":"oJAKA,MAAMA,EAAsB,6CAErB,SAASC,IACd,MAAOC,EAAQC,GAAaC,YAAS,IAC9BC,EAAUC,GAAeF,EAAAA,SAAwB,KACjDG,EAAcC,GAAmBJ,WAAS,KAC1CK,EAAWC,GAAgBN,YAAS,IACpCO,GAAaP,EAAAA,SAAS,IAAM,GAAGQ,EAAUC,qBAAqBC,KAAKC,SAASC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,OACjHC,EAAeC,GAAoBjB,YAAS,GAC7CkB,EAAiBC,SAAuB,MACxCC,EAAWD,SAAyB,MAE1CE,EAAAA,UAAU,KAEJ,IADeC,aAAaC,QAAQf,EAAUgB,uBAC9BR,EAAe,CAC3B,MAAAS,EAAQC,WAAW,KACvB3B,GAAU,GACVkB,GAAiB,GACJK,aAAAK,QAAQnB,EAAUgB,oBAAqB,QAEpD,MAAMI,EAA8B,CAClCC,GAAI,OAAOnB,KAAKC,QAChBJ,YACAuB,QAAStB,EAAUuB,wBACnBC,WAAW,IAAItB,MAAOuB,cACtBC,QAASC,OAAOC,SAASC,KACzBC,OAAQ9B,EAAU+B,uBAClBC,OAAO,GAEGtC,EAAA,CAAC0B,KACZpB,EAAUiC,4BAEN,MAAA,IAAMC,aAAajB,EAC5B,GACC,CAACT,EAAeT,IAGnBc,EAAAA,UAAU,KACR,MAAMsB,EAAoB,KAEpB,GADJ5C,GAAU,GACc,IAApBE,EAAS2C,OAAc,CACzB,MAAMhB,EAA8B,CAClCC,GAAI,OAAOnB,KAAKC,QAChBJ,YACAuB,QAAStB,EAAUuB,wBACnBC,WAAW,IAAItB,MAAOuB,cACtBC,QAASC,OAAOC,SAASC,KACzBC,OAAQ9B,EAAU+B,uBAClBC,OAAO,GAEGtC,EAAA,CAAC0B,GACf,GAIF,OADOO,OAAAU,iBAAiB,cAAeF,GAChC,IAAMR,OAAOW,oBAAoB,cAAeH,IACtD,CAACpC,EAAWN,EAAS2C,SAExBvB,EAAAA,UAAU,WACR,OAAA0B,EAAA7B,EAAe8B,UAAfD,EAAwBE,eAAe,CAAEC,SAAU,YAClD,CAACjD,IAEJoB,EAAAA,UAAU,WACJvB,IAAWO,IACb,OAAA0C,EAAA3B,EAAS4B,UAASD,EAAAI,UAEnB,CAACrD,EAAQO,IAgHP,aAAA+C,EAAAA,SAAA,CAAAC,SAAAvD,UACE,MAAA,CAAIwD,UAAU,6MACbD,SAAA,GAACE,KAAA,MAAA,CAAID,UAAU,iFACbD,SAAA,QAAC,MACC,CAAAA,SAAA,OAAC,KAAA,CAAGC,UAAU,+BAA+BD,SAAQ,mBACpD,IAAA,CAAEC,UAAU,wBAAwBD,SAAmB,2BAE1DG,EAAAC,IAAC,SAAA,CACCC,QAAS,IAAM3D,GAAU,GACzBuD,UAAU,4DACV,aAAW,aAEXD,SAACI,EAAAA,IAAAE,EAAE,CAAAL,UAAU,mBAIhBC,KAAA,MAAI,CAAAD,UAAU,oDACZD,SAAA,CAASpD,EAAA2D,IAAKC,GACbL,EAAAC,IAAC,MAAA,CAECH,UAAW,SAAQO,EAAIrB,MAAQ,gBAAkB,eAEjDa,SAAAG,EAAAC,IAAC,MAAA,CACCH,UAAW,eACTO,EAAIrB,MACA,sDACA,4EAGNa,eAAC,IAAA,CAAEC,UAAU,uCAAwCD,WAAIvB,aAVtD+B,EAAIhC,KAcZxB,KACEoD,IAAA,MAAI,CAAAH,UAAU,qBACbD,SAACI,EAAAA,IAAA,MAAI,CAAAH,UAAU,qEACbD,SAAAE,EAAAA,KAAC,MAAI,CAAAD,UAAU,iBACbD,SAAA,GAACI,IAAA,MAAA,CAAIH,UAAU,oDACfG,MAAC,OAAIH,UAAU,kDAAkDQ,MAAO,CAAEC,eAAgB,UAC1FN,MAAC,OAAIH,UAAU,kDAAkDQ,MAAO,CAAEC,eAAgB,mBAKjGN,IAAA,MAAI,CAAAO,IAAK9C,cAGX,OAAA,CAAK+C,SA7JOC,MAAOC,IAE1B,GADAA,EAAEC,kBACGjE,EAAakE,QAAUhE,EAAW,OAEvC,MAAMiE,EAA2B,CAC/BzC,GAAI,OAAOnB,KAAKC,QAChBJ,YACAuB,QAAS3B,EACT6B,WAAW,IAAItB,MAAOuB,cACtBC,QAASC,OAAOC,SAASC,KACzBC,OAAQ,kBACRE,OAAO,GAGTtC,EAAaqE,GAAS,IAAIA,EAAMD,IAChClE,EAAgB,IAChBE,GAAa,GAET,IACF,GAAIV,EAAqB,CACf4E,QAAAC,IAAI,sBAAuB7E,GACnC4E,QAAQC,IAAI,WAAY,CACtBlE,UAAW+D,EAAY/D,UACvBuB,QAASwC,EAAYxC,QACrBE,UAAWsC,EAAYtC,UACvBE,QAASoC,EAAYpC,QACrBI,OAAQgC,EAAYhC,SAGhB,MAAAoC,QAAiBC,MAAM/E,EAAqB,CAChDgF,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU,CACnBzE,UAAW+D,EAAY/D,UACvBuB,QAASwC,EAAYxC,QACrBE,UAAWsC,EAAYtC,UACvBE,QAASoC,EAAYpC,QACrBI,OAAQgC,EAAYhC,WAOxB,GAHQkC,QAAAC,IAAI,mBAAoBC,EAASO,QACjCT,QAAAC,IAAI,eAAgBC,EAASQ,KAEjCR,EAASQ,GAgCL,MADEV,QAAAW,MAAM,8BAA+BT,EAASO,QAChD,IAAIG,MAAM,kBAhCD,CACT,MAAAC,QAAqBX,EAASY,OAGhC,IAAAC,EAFIf,QAAAC,IAAI,qBAAsBY,GAG9B,IACKE,EAAAR,KAAKS,MAAMH,GACVb,QAAAC,IAAI,wBAAyBc,GAGjCE,MAAMC,QAAQH,IAASA,EAAK3C,OAAS,IACvC2C,EAAOA,EAAK,GACJf,QAAAC,IAAI,mCAAoCc,UAE3CI,GACCnB,QAAAW,MAAM,oBAAqBQ,GACnCnB,QAAQC,IAAI,oDACLc,EAAA,CAAEK,OAAQP,EACnB,CAEA,MAAMQ,EAAwB,CAC5BhE,GAAI,OAAOnB,KAAKC,QAChBJ,YACAuB,QAASyD,EAAKK,QAAUL,EAAKO,OAAS,0DACtC9D,WAAW,IAAItB,MAAOuB,cACtBC,QAASC,OAAOC,SAASC,KACzBC,OAAQ,kBACRE,OAAO,GAETtC,EAAaqE,GAAS,IAAIA,EAAMsB,GAAS,CAiB7C,QACOV,GACCX,QAAAW,MAAM,iBAAkBA,GAChC,MAAMY,EAA4B,CAChClE,GAAI,OAAOnB,KAAKC,QAChBJ,YACAuB,QAAS,8EACTE,WAAW,IAAItB,MAAOuB,cACtBC,QAASC,OAAOC,SAASC,KACzBC,OAAQ,kBACRE,OAAO,GAETtC,EAAaqE,GAAS,IAAIA,EAAMwB,GAAa,CAC7C,QACAzF,GAAa,EACf,GAoDoCgD,UAAU,yDACtCD,SAAA,CAAAG,EAAAC,IAAC,QAAA,CACCO,IAAK5C,EACL4E,KAAK,OACLC,MAAO9F,EACP+F,SAAW/B,GAAM/D,EAAgB+D,EAAEgC,OAAOF,OAC1CG,YAAY,kBACZ9C,UAAU,8GACV+C,SAAUhG,IAEZmD,EAAAC,IAAC,SAAA,CACCuC,KAAK,SACLK,SAAUhG,IAAcF,EAAakE,OACrCf,UAAU,mPAEVD,SAACI,EAAAA,IAAA6C,EAAK,CAAAhD,UAAU,qBAO9B"}