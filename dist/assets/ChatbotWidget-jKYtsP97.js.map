{"version":3,"file":"ChatbotWidget-jKYtsP97.js","sources":["../../src/components/ChatbotWidget.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { X, Send } from 'lucide-react';\nimport { ChatMessage } from '../types';\n\nconst CHATBOT_WEBHOOK_URL = import.meta.env.VITE_CHATBOT_WEBHOOK_URL || '';\n\nexport function ChatbotWidget() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [sessionId] = useState(() => `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\n  const [hasAutoOpened, setHasAutoOpened] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    const hasVisited = localStorage.getItem('chatbot_visited');\n    if (!hasVisited && !hasAutoOpened) {\n      const timer = setTimeout(() => {\n        setIsOpen(true);\n        setHasAutoOpened(true);\n        localStorage.setItem('chatbot_visited', 'true');\n\n        const welcomeMessage: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Hello! I'm Antek AI. How can I help you automate your business today?\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages([welcomeMessage]);\n      }, 5000);\n\n      return () => clearTimeout(timer);\n    }\n  }, [hasAutoOpened, sessionId]);\n\n  // Listen for custom event to open chatbot\n  useEffect(() => {\n    const handleOpenChatbot = () => {\n      setIsOpen(true);\n      if (messages.length === 0) {\n        const welcomeMessage: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Hello! I'm Antek AI. How can I help you automate your business today?\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages([welcomeMessage]);\n      }\n    };\n\n    window.addEventListener('openChatbot', handleOpenChatbot);\n    return () => window.removeEventListener('openChatbot', handleOpenChatbot);\n  }, [sessionId, messages.length]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  useEffect(() => {\n    if (isOpen && !isLoading) {\n      inputRef.current?.focus();\n    }\n  }, [isOpen, isLoading]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!inputMessage.trim() || isLoading) return;\n\n    const userMessage: ChatMessage = {\n      id: `msg_${Date.now()}`,\n      sessionId,\n      message: inputMessage,\n      timestamp: new Date().toISOString(),\n      pageUrl: window.location.href,\n      source: 'website_chatbot',\n      isBot: false,\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setInputMessage('');\n    setIsLoading(true);\n\n    try {\n      if (CHATBOT_WEBHOOK_URL) {\n        console.log('Sending to webhook:', CHATBOT_WEBHOOK_URL);\n        console.log('Payload:', {\n          sessionId: userMessage.sessionId,\n          message: userMessage.message,\n          timestamp: userMessage.timestamp,\n          pageUrl: userMessage.pageUrl,\n          source: userMessage.source,\n        });\n\n        const response = await fetch(CHATBOT_WEBHOOK_URL, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            sessionId: userMessage.sessionId,\n            message: userMessage.message,\n            timestamp: userMessage.timestamp,\n            pageUrl: userMessage.pageUrl,\n            source: userMessage.source,\n          }),\n        });\n\n        console.log('Response status:', response.status);\n        console.log('Response ok:', response.ok);\n\n        if (response.ok) {\n          const responseText = await response.text();\n          console.log('Raw response text:', responseText);\n\n          let data;\n          try {\n            data = JSON.parse(responseText);\n            console.log('Parsed response data:', data);\n\n            // Handle array response format from n8n\n            if (Array.isArray(data) && data.length > 0) {\n              data = data[0];\n              console.log('Extracted first item from array:', data);\n            }\n          } catch (parseError) {\n            console.error('JSON parse error:', parseError);\n            console.log('Response was not valid JSON, using as plain text');\n            data = { output: responseText };\n          }\n\n          const botReply: ChatMessage = {\n            id: `msg_${Date.now()}`,\n            sessionId,\n            message: data.output || data.reply || \"Thanks for your message! We'll get back to you shortly.\",\n            timestamp: new Date().toISOString(),\n            pageUrl: window.location.href,\n            source: 'website_chatbot',\n            isBot: true,\n          };\n          setMessages((prev) => [...prev, botReply]);\n        } else {\n          console.error('Webhook failed with status:', response.status);\n          throw new Error('Webhook failed');\n        }\n      } else {\n        console.log('No webhook URL configured');\n        const botReply: ChatMessage = {\n          id: `msg_${Date.now()}`,\n          sessionId,\n          message: \"Thanks for reaching out! Our team will respond soon. You can also email us at hello@antekautomation.com\",\n          timestamp: new Date().toISOString(),\n          pageUrl: window.location.href,\n          source: 'website_chatbot',\n          isBot: true,\n        };\n        setMessages((prev) => [...prev, botReply]);\n      }\n    } catch (error) {\n      console.error('Chatbot error:', error);\n      const errorMessage: ChatMessage = {\n        id: `msg_${Date.now()}`,\n        sessionId,\n        message: \"Connection error. Please try again or email us at hello@antekautomation.com\",\n        timestamp: new Date().toISOString(),\n        pageUrl: window.location.href,\n        source: 'website_chatbot',\n        isBot: true,\n      };\n      setMessages((prev) => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"fixed bottom-6 right-6 w-15 h-15 bg-terracotta border-3 border-charcoal shadow-brutal-sm rounded-sm flex items-center justify-center hover:-translate-x-[2px] hover:-translate-y-[2px] hover:shadow-brutal transition-all duration-200 z-50\"\n        aria-label=\"Open chat\"\n      >\n        {isOpen ? (\n          <X className=\"w-7 h-7 text-off-white\" />\n        ) : (\n          <span className=\"text-2xl font-black text-off-white\">C</span>\n        )}\n      </button>\n\n      {isOpen && (\n        <div className=\"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50\">\n          <div className=\"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-black text-xl uppercase\">Antek AI</h3>\n              <p className=\"text-xs text-charcoal\">Always here to help</p>\n            </div>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white\">\n            {messages.map((msg) => (\n              <div\n                key={msg.id}\n                className={`flex ${msg.isBot ? 'justify-start' : 'justify-end'}`}\n              >\n                <div\n                  className={`max-w-[70%] ${\n                    msg.isBot\n                      ? 'bg-white border-2 border-charcoal shadow-brutal-msg'\n                      : 'bg-warm-beige border-2 border-charcoal shadow-brutal-msg'\n                  } p-3 rounded-sm`}\n                >\n                  <p className=\"text-charcoal text-sm leading-normal\">{msg.message}</p>\n                </div>\n              </div>\n            ))}\n            {isLoading && (\n              <div className=\"flex justify-start\">\n                <div className=\"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm\">\n                  <div className=\"flex space-x-2\">\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white\">\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={inputMessage}\n              onChange={(e) => setInputMessage(e.target.value)}\n              placeholder=\"Type message...\"\n              className=\"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal\"\n              disabled={isLoading}\n            />\n            <button\n              type=\"submit\"\n              disabled={isLoading || !inputMessage.trim()}\n              className=\"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <Send className=\"w-5 h-5\" />\n            </button>\n          </form>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["CHATBOT_WEBHOOK_URL","ChatbotWidget","isOpen","setIsOpen","useState","messages","setMessages","inputMessage","setInputMessage","isLoading","setIsLoading","sessionId","hasAutoOpened","setHasAutoOpened","messagesEndRef","useRef","inputRef","useEffect","timer","welcomeMessage","handleOpenChatbot","_a","handleSubmit","e","userMessage","prev","response","responseText","data","parseError","botReply","error","errorMessage","jsxs","Fragment","jsx","X","msg","Send"],"mappings":"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"}