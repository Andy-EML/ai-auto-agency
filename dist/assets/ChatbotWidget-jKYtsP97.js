import{j as e}from"./index-CtHWkoXC.js";import{r as o}from"./vendor-react-YsBxPMQB.js";import{X as N,S as I}from"./vendor-icons-INnbd17C.js";const p="https://auto.juxtarank.com/webhook/chatbot";function D(){const[i,u]=o.useState(!1),[h,c]=o.useState([]),[m,f]=o.useState(""),[l,g]=o.useState(!1),[n]=o.useState(()=>`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),[w,j]=o.useState(!1),x=o.useRef(null),y=o.useRef(null);o.useEffect(()=>{if(!localStorage.getItem("chatbot_visited")&&!w){const s=setTimeout(()=>{u(!0),j(!0),localStorage.setItem("chatbot_visited","true");const r={id:`msg_${Date.now()}`,sessionId:n,message:"Hello! I'm Antek AI. How can I help you automate your business today?",timestamp:new Date().toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};c([r])},5e3);return()=>clearTimeout(s)}},[w,n]),o.useEffect(()=>{const t=()=>{if(u(!0),h.length===0){const s={id:`msg_${Date.now()}`,sessionId:n,message:"Hello! I'm Antek AI. How can I help you automate your business today?",timestamp:new Date().toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};c([s])}};return window.addEventListener("openChatbot",t),()=>window.removeEventListener("openChatbot",t)},[n,h.length]),o.useEffect(()=>{var t;(t=x.current)==null||t.scrollIntoView({behavior:"smooth"})},[h]),o.useEffect(()=>{var t;i&&!l&&((t=y.current)==null||t.focus())},[i,l]);const v=async t=>{if(t.preventDefault(),!m.trim()||l)return;const s={id:`msg_${Date.now()}`,sessionId:n,message:m,timestamp:new Date().toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!1};c(r=>[...r,s]),f(""),g(!0);try{if(p){console.log("Sending to webhook:",p),console.log("Payload:",{sessionId:s.sessionId,message:s.message,timestamp:s.timestamp,pageUrl:s.pageUrl,source:s.source});const r=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s.sessionId,message:s.message,timestamp:s.timestamp,pageUrl:s.pageUrl,source:s.source})});if(console.log("Response status:",r.status),console.log("Response ok:",r.ok),r.ok){const d=await r.text();console.log("Raw response text:",d);let a;try{a=JSON.parse(d),console.log("Parsed response data:",a),Array.isArray(a)&&a.length>0&&(a=a[0],console.log("Extracted first item from array:",a))}catch(b){console.error("JSON parse error:",b),console.log("Response was not valid JSON, using as plain text"),a={output:d}}const S={id:`msg_${Date.now()}`,sessionId:n,message:a.output||a.reply||"Thanks for your message! We'll get back to you shortly.",timestamp:new Date().toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};c(b=>[...b,S])}else throw console.error("Webhook failed with status:",r.status),new Error("Webhook failed")}}catch(r){console.error("Chatbot error:",r);const d={id:`msg_${Date.now()}`,sessionId:n,message:"Connection error. Please try again or email us at hello@antekautomation.com",timestamp:new Date().toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};c(a=>[...a,d])}finally{g(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(!i),className:"fixed bottom-6 right-6 w-15 h-15 bg-terracotta border-3 border-charcoal shadow-brutal-sm rounded-sm flex items-center justify-center hover:-translate-x-[2px] hover:-translate-y-[2px] hover:shadow-brutal transition-all duration-200 z-50","aria-label":"Open chat",children:i?e.jsx(N,{className:"w-7 h-7 text-off-white"}):e.jsx("span",{className:"text-2xl font-black text-off-white",children:"C"})}),i&&e.jsxs("div",{className:"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50",children:[e.jsx("div",{className:"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-xl uppercase",children:"Antek AI"}),e.jsx("p",{className:"text-xs text-charcoal",children:"Always here to help"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white",children:[h.map(t=>e.jsx("div",{className:`flex ${t.isBot?"justify-start":"justify-end"}`,children:e.jsx("div",{className:`max-w-[70%] ${t.isBot?"bg-white border-2 border-charcoal shadow-brutal-msg":"bg-warm-beige border-2 border-charcoal shadow-brutal-msg"} p-3 rounded-sm`,children:e.jsx("p",{className:"text-charcoal text-sm leading-normal",children:t.message})})},t.id)),l&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})}),e.jsx("div",{ref:x})]}),e.jsxs("form",{onSubmit:v,className:"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white",children:[e.jsx("input",{ref:y,type:"text",value:m,onChange:t=>f(t.target.value),placeholder:"Type message...",className:"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal",disabled:l}),e.jsx("button",{type:"submit",disabled:l||!m.trim(),className:"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(I,{className:"w-5 h-5"})})]})]})]})}export{D as ChatbotWidget};
//# sourceMappingURL=ChatbotWidget-jKYtsP97.js.map
