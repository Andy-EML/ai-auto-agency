import{C as e,j as t}from"./index-CKoJYvc1.js";import{r as s}from"./vendor-react-9fiDQRhm.js";import{X as o,S as a}from"./vendor-icons-DDcCaDA3.js";const r="https://auto.juxtarank.com/webhook/chatbot";function l(){const[l,n]=s.useState(!1),[i,c]=s.useState([]),[d,m]=s.useState(""),[h,u]=s.useState(!1),[g]=s.useState(()=>`${e.SESSION_ID_PREFIX}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),[b,p]=s.useState(!1),f=s.useRef(null),w=s.useRef(null);s.useEffect(()=>{if(!localStorage.getItem(e.CHATBOT_VISITED_KEY)&&!b){const t=setTimeout(()=>{n(!0),p(!0),localStorage.setItem(e.CHATBOT_VISITED_KEY,"true");const t={id:`msg_${Date.now()}`,sessionId:g,message:e.CHATBOT_WELCOME_MESSAGE,timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:e.WEBHOOK_SOURCE_CHATBOT,isBot:!0};c([t])},e.CHATBOT_AUTO_OPEN_DELAY_MS);return()=>clearTimeout(t)}},[b,g]),s.useEffect(()=>{const t=()=>{if(n(!0),0===i.length){const t={id:`msg_${Date.now()}`,sessionId:g,message:e.CHATBOT_WELCOME_MESSAGE,timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:e.WEBHOOK_SOURCE_CHATBOT,isBot:!0};c([t])}};return window.addEventListener("openChatbot",t),()=>window.removeEventListener("openChatbot",t)},[g,i.length]),s.useEffect(()=>{var e;null==(e=f.current)||e.scrollIntoView({behavior:"smooth"})},[i]),s.useEffect(()=>{var e;l&&!h&&(null==(e=w.current)||e.focus())},[l,h]);return t.jsx(t.Fragment,{children:l&&t.jsxs("div",{className:"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50",children:[t.jsxs("div",{className:"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-black text-xl uppercase",children:"Antek AI"}),t.jsx("p",{className:"text-xs text-charcoal",children:"Always here to help"})]}),t.jsx("button",{onClick:()=>n(!1),className:"text-charcoal hover:text-terracotta transition-colors p-2","aria-label":"Close chat",children:t.jsx(o,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white",children:[i.map(e=>t.jsx("div",{className:"flex "+(e.isBot?"justify-start":"justify-end"),children:t.jsx("div",{className:`max-w-[70%] ${e.isBot?"bg-white border-2 border-charcoal shadow-brutal-msg":"bg-warm-beige border-2 border-charcoal shadow-brutal-msg"} p-3 rounded-sm`,children:t.jsx("p",{className:"text-charcoal text-sm leading-normal",children:e.message})})},e.id)),h&&t.jsx("div",{className:"flex justify-start",children:t.jsx("div",{className:"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm",children:t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),t.jsx("div",{className:"w-2 h-2 bg-charcoal rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})}),t.jsx("div",{ref:f})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!d.trim()||h)return;const t={id:`msg_${Date.now()}`,sessionId:g,message:d,timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!1};c(e=>[...e,t]),m(""),u(!0);try{if(r){console.log("Sending to webhook:",r),console.log("Payload:",{sessionId:t.sessionId,message:t.message,timestamp:t.timestamp,pageUrl:t.pageUrl,source:t.source});const e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t.sessionId,message:t.message,timestamp:t.timestamp,pageUrl:t.pageUrl,source:t.source})});if(console.log("Response status:",e.status),console.log("Response ok:",e.ok),!e.ok)throw console.error("Webhook failed with status:",e.status),new Error("Webhook failed");{const t=await e.text();let o;console.log("Raw response text:",t);try{o=JSON.parse(t),console.log("Parsed response data:",o),Array.isArray(o)&&o.length>0&&(o=o[0],console.log("Extracted first item from array:",o))}catch(s){console.error("JSON parse error:",s),console.log("Response was not valid JSON, using as plain text"),o={output:t}}const a={id:`msg_${Date.now()}`,sessionId:g,message:o.output||o.reply||"Thanks for your message! We'll get back to you shortly.",timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};c(e=>[...e,a])}}}catch(o){console.error("Chatbot error:",o);const e={id:`msg_${Date.now()}`,sessionId:g,message:"Connection error. Please try again or email us at hello@antekautomation.com",timestamp:(new Date).toISOString(),pageUrl:window.location.href,source:"website_chatbot",isBot:!0};c(t=>[...t,e])}finally{u(!1)}},className:"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white",children:[t.jsx("input",{ref:w,type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"Type message...",className:"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal",disabled:h}),t.jsx("button",{type:"submit",disabled:h||!d.trim(),className:"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(a,{className:"w-5 h-5"})})]})]})})}export{l as ChatbotWidget};
//# sourceMappingURL=ChatbotWidget-oTO3xQFs.js.map
