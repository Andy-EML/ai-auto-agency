{"version":3,"file":"ChatbotWidget-oTO3xQFs.js","sources":["../../src/components/ChatbotWidget.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { X, Send } from 'lucide-react';\r\nimport { ChatMessage } from '../types';\r\nimport { CONSTANTS } from '../constants';\r\n\r\nconst CHATBOT_WEBHOOK_URL = import.meta.env.VITE_CHATBOT_WEBHOOK_URL || '';\r\n\r\nexport function ChatbotWidget() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [sessionId] = useState(() => `${CONSTANTS.SESSION_ID_PREFIX}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);\r\n  const [hasAutoOpened, setHasAutoOpened] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    const hasVisited = localStorage.getItem(CONSTANTS.CHATBOT_VISITED_KEY);\r\n    if (!hasVisited && !hasAutoOpened) {\r\n      const timer = setTimeout(() => {\r\n        setIsOpen(true);\r\n        setHasAutoOpened(true);\r\n        localStorage.setItem(CONSTANTS.CHATBOT_VISITED_KEY, 'true');\r\n\r\n        const welcomeMessage: ChatMessage = {\r\n          id: `msg_${Date.now()}`,\r\n          sessionId,\r\n          message: CONSTANTS.CHATBOT_WELCOME_MESSAGE,\r\n          timestamp: new Date().toISOString(),\r\n          pageUrl: window.location.href,\r\n          source: CONSTANTS.WEBHOOK_SOURCE_CHATBOT,\r\n          isBot: true,\r\n        };\r\n        setMessages([welcomeMessage]);\r\n      }, CONSTANTS.CHATBOT_AUTO_OPEN_DELAY_MS);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [hasAutoOpened, sessionId]);\r\n\r\n  // Listen for custom event to open chatbot\r\n  useEffect(() => {\r\n    const handleOpenChatbot = () => {\r\n      setIsOpen(true);\r\n      if (messages.length === 0) {\r\n        const welcomeMessage: ChatMessage = {\r\n          id: `msg_${Date.now()}`,\r\n          sessionId,\r\n          message: CONSTANTS.CHATBOT_WELCOME_MESSAGE,\r\n          timestamp: new Date().toISOString(),\r\n          pageUrl: window.location.href,\r\n          source: CONSTANTS.WEBHOOK_SOURCE_CHATBOT,\r\n          isBot: true,\r\n        };\r\n        setMessages([welcomeMessage]);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('openChatbot', handleOpenChatbot);\r\n    return () => window.removeEventListener('openChatbot', handleOpenChatbot);\r\n  }, [sessionId, messages.length]);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && !isLoading) {\r\n      inputRef.current?.focus();\r\n    }\r\n  }, [isOpen, isLoading]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!inputMessage.trim() || isLoading) return;\r\n\r\n    const userMessage: ChatMessage = {\r\n      id: `msg_${Date.now()}`,\r\n      sessionId,\r\n      message: inputMessage,\r\n      timestamp: new Date().toISOString(),\r\n      pageUrl: window.location.href,\r\n      source: 'website_chatbot',\r\n      isBot: false,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage]);\r\n    setInputMessage('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (CHATBOT_WEBHOOK_URL) {\r\n        console.log('Sending to webhook:', CHATBOT_WEBHOOK_URL);\r\n        console.log('Payload:', {\r\n          sessionId: userMessage.sessionId,\r\n          message: userMessage.message,\r\n          timestamp: userMessage.timestamp,\r\n          pageUrl: userMessage.pageUrl,\r\n          source: userMessage.source,\r\n        });\r\n\r\n        const response = await fetch(CHATBOT_WEBHOOK_URL, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            sessionId: userMessage.sessionId,\r\n            message: userMessage.message,\r\n            timestamp: userMessage.timestamp,\r\n            pageUrl: userMessage.pageUrl,\r\n            source: userMessage.source,\r\n          }),\r\n        });\r\n\r\n        console.log('Response status:', response.status);\r\n        console.log('Response ok:', response.ok);\r\n\r\n        if (response.ok) {\r\n          const responseText = await response.text();\r\n          console.log('Raw response text:', responseText);\r\n\r\n          let data;\r\n          try {\r\n            data = JSON.parse(responseText);\r\n            console.log('Parsed response data:', data);\r\n\r\n            // Handle array response format from n8n\r\n            if (Array.isArray(data) && data.length > 0) {\r\n              data = data[0];\r\n              console.log('Extracted first item from array:', data);\r\n            }\r\n          } catch (parseError) {\r\n            console.error('JSON parse error:', parseError);\r\n            console.log('Response was not valid JSON, using as plain text');\r\n            data = { output: responseText };\r\n          }\r\n\r\n          const botReply: ChatMessage = {\r\n            id: `msg_${Date.now()}`,\r\n            sessionId,\r\n            message: data.output || data.reply || \"Thanks for your message! We'll get back to you shortly.\",\r\n            timestamp: new Date().toISOString(),\r\n            pageUrl: window.location.href,\r\n            source: 'website_chatbot',\r\n            isBot: true,\r\n          };\r\n          setMessages((prev) => [...prev, botReply]);\r\n        } else {\r\n          console.error('Webhook failed with status:', response.status);\r\n          throw new Error('Webhook failed');\r\n        }\r\n      } else {\r\n        console.log('No webhook URL configured');\r\n        const botReply: ChatMessage = {\r\n          id: `msg_${Date.now()}`,\r\n          sessionId,\r\n          message: \"Thanks for reaching out! Our team will respond soon. You can also email us at hello@antekautomation.com\",\r\n          timestamp: new Date().toISOString(),\r\n          pageUrl: window.location.href,\r\n          source: 'website_chatbot',\r\n          isBot: true,\r\n        };\r\n        setMessages((prev) => [...prev, botReply]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Chatbot error:', error);\r\n      const errorMessage: ChatMessage = {\r\n        id: `msg_${Date.now()}`,\r\n        sessionId,\r\n        message: \"Connection error. Please try again or email us at hello@antekautomation.com\",\r\n        timestamp: new Date().toISOString(),\r\n        pageUrl: window.location.href,\r\n        source: 'website_chatbot',\r\n        isBot: true,\r\n      };\r\n      setMessages((prev) => [...prev, errorMessage]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {isOpen && (\r\n        <div className=\"fixed bottom-24 left-4 right-4 md:bottom-24 md:right-6 md:left-auto w-auto md:w-[400px] max-h-[calc(100vh-150px)] md:h-[600px] bg-off-white border-3 border-charcoal shadow-brutal-chat flex flex-col z-50\">\r\n          <div className=\"bg-warm-beige border-b-3 border-charcoal p-4 flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"font-black text-xl uppercase\">Antek AI</h3>\r\n              <p className=\"text-xs text-charcoal\">Always here to help</p>\r\n            </div>\r\n            <button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"text-charcoal hover:text-terracotta transition-colors p-2\"\r\n              aria-label=\"Close chat\"\r\n            >\r\n              <X className=\"w-6 h-6\" />\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-off-white\">\r\n            {messages.map((msg) => (\r\n              <div\r\n                key={msg.id}\r\n                className={`flex ${msg.isBot ? 'justify-start' : 'justify-end'}`}\r\n              >\r\n                <div\r\n                  className={`max-w-[70%] ${\r\n                    msg.isBot\r\n                      ? 'bg-white border-2 border-charcoal shadow-brutal-msg'\r\n                      : 'bg-warm-beige border-2 border-charcoal shadow-brutal-msg'\r\n                  } p-3 rounded-sm`}\r\n                >\r\n                  <p className=\"text-charcoal text-sm leading-normal\">{msg.message}</p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n            {isLoading && (\r\n              <div className=\"flex justify-start\">\r\n                <div className=\"bg-white border-2 border-charcoal shadow-brutal-msg p-3 rounded-sm\">\r\n                  <div className=\"flex space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\"></div>\r\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\r\n                    <div className=\"w-2 h-2 bg-charcoal rounded-full animate-bounce\" style={{ animationDelay: '0.4s' }}></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"border-t-3 border-charcoal p-4 flex gap-2 bg-off-white\">\r\n            <input\r\n              ref={inputRef}\r\n              type=\"text\"\r\n              value={inputMessage}\r\n              onChange={(e) => setInputMessage(e.target.value)}\r\n              placeholder=\"Type message...\"\r\n              className=\"flex-1 border-3 border-charcoal px-3 py-2 focus:border-terracotta focus:outline-none bg-white text-charcoal\"\r\n              disabled={isLoading}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              disabled={isLoading || !inputMessage.trim()}\r\n              className=\"bg-terracotta text-off-white px-4 py-2 border-3 border-charcoal shadow-brutal-xs font-black hover:-translate-x-[1px] hover:-translate-y-[1px] hover:shadow-brutal-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <Send className=\"w-5 h-5\" />\r\n            </button>\r\n          </form>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":["CHATBOT_WEBHOOK_URL","ChatbotWidget","isOpen","setIsOpen","useState","messages","setMessages","inputMessage","setInputMessage","isLoading","setIsLoading","sessionId","CONSTANTS","SESSION_ID_PREFIX","Date","now","Math","random","toString","substr","hasAutoOpened","setHasAutoOpened","messagesEndRef","useRef","inputRef","useEffect","localStorage","getItem","CHATBOT_VISITED_KEY","timer","setTimeout","setItem","welcomeMessage","id","message","CHATBOT_WELCOME_MESSAGE","timestamp","toISOString","pageUrl","window","location","href","source","WEBHOOK_SOURCE_CHATBOT","isBot","CHATBOT_AUTO_OPEN_DELAY_MS","clearTimeout","handleOpenChatbot","length","addEventListener","removeEventListener","_a","current","scrollIntoView","behavior","focus","Fragment","children","className","jsxs","jsxRuntimeExports","jsx","onClick","X","map","msg","style","animationDelay","ref","onSubmit","async","e","preventDefault","trim","userMessage","prev","console","log","response","fetch","method","headers","body","JSON","stringify","status","ok","error","Error","responseText","text","data","parse","Array","isArray","parseError","output","botReply","reply","errorMessage","type","value","onChange","target","placeholder","disabled","Send"],"mappings":"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"}